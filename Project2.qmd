---
title: "Project 2"
format: html
editor: visual
---

## The Data

US Superstore data

```{r}
# Load libraries
library(tidyverse)
library(readxl)
```

```{r}
# Load excel file with column names and types
superstore <- read_excel("US Superstore data.xls", sheet = 1,
                         col_names = c("Row_ID", "Order_ID", "Order_Date",
                                       "Ship_Date", "Ship_Mode", "Customer_ID",
                                       "Customer_Name", "Segment", "Country",
                                       "City", "State", "Postal_Code",
                                       "Region", "Product_ID", "Category",
                                       "Sub_Category", "Product_Name", "Sales",
                                       "Quantity", "Discount", "Profit"),
                         col_types = c("numeric", "text", "date", "date",
                                       "text", "text", "text", "text", "text",
                                       "text", "text", "text", "text", "text",
                                       "text", "text", "text", "numeric",
                                       "numeric", "numeric", "numeric"),
                         skip = 1
)
superstore
```

The US Superstore Data Set has 9994 observations across 21 variables.

```{r}
# Add up the number of missing values per column.
colSums(is.na(superstore))
```

As you can see there is no missing data in this data set.

### Investigate the data

#### One-way Contingency Tables

Row ID: Double

-   A unique ID for every entry.

```{r}
# One-Way Contingency Table for Row ID
superstore |>
  group_by(Row_ID) |>
  summarize(count = n())
```

Order ID: Character

-   A unique ID for each order, however there's so many orders that this is not useful for subsetting the data.

```{r}
# One-Way Contingency Table  for Order ID
superstore |>
  group_by(Order_ID) |>
  summarize(count = n())
```

Order Date and Ship Date: both Datetime

-   When the order was made and when it was shipped.

```{r}
# One-Way Contingency Table for Order Date
superstore |>
  group_by(Order_Date) |>
  summarize(count = n())
```

```{r}
# One-Way Contingency Table for Ship Date
superstore |>
  group_by(Ship_Date) |>
  summarize(count = n())
```

Ship Mode: Character

-   The type of shipping, good for categorical grouping.

```{r}
# One-Way Contingency Table for Ship Mode
superstore |>
  group_by(Ship_Mode) |>
  summarize(count = n())
```

Customer ID and Customer Name: both Character

-   A unique ID (and the name) for each customer. There's too many to use as a subset.

```{r}
# One-Way Contingency Table for Customer Name
# The One-Way Contingency Table for Customer ID would look similar
superstore |>
  group_by(Customer_Name) |>
  summarize(count = n())
```

Segment: Character

-   Type of customer, good for categorical grouping.

```{r}
# One-Way Contingency Table for Segment
superstore |>
  group_by(Segment) |>
  summarize(count = n())
```

Country: Character

-   The Country the order was made in. The United States is the only country.

```{r}
# One-Way Contingency Table for Country
superstore |>
  group_by(Country) |>
  summarize(count = n())
```

City: Character

-   The name of the city. There may be too many cities to be useful for subsetting.

```{r}
# One-Way Contingency Table for City
superstore |>
  group_by(City) |>
  summarize(count = n())
```

State: Character

-   State name, could be a categorical grouping variable.

```{r}
# One-Way Contingency Table for State
superstore |>
  group_by(State) |>
  summarize(count = n())
```

Postal Code: Character

-   The postal code for that area. Too many to use as a subsetting variable.

```{r}
# One-Way Contingency Table for Postal Code
superstore |>
  group_by(Postal_Code) |>
  summarize(count = n())
```

Region: Character

-   The region of the country for that order, good for categorical grouping.

```{r}
# One-Way Contingency Table for Region
superstore |>
  group_by(Region) |>
  summarize(count = n())
```

Product ID and Product Name: Character

-   A unique ID (and name) for each product, too many of them to be used as subsets.

```{r}
# One-Way Contingency Table for Product Name
# The One-Way Contingency Table for Product ID would look similar
superstore |>
  group_by(Product_Name) |>
  summarize(count = n())
```

Category: Character

-   The category of the product, good for categorical grouping.

```{r}
# One-Way Contingency Table for Category
superstore |>
  group_by(Category) |>
  summarize(count = n())
```

Sub-Category: Character

-   The subcategory of each product, could also use as a categorical grouping variable.

```{r}
# One-Way Contingency Table for Sub Category
superstore |>
  group_by(Sub_Category) |>
  summarize(count = n())
```

#### Two-Way Contingency Tables

We can look at the Two-Way Contingency Table of Category and Sub_Category to see which Sub_Categories belong to which Category.

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Category, Sub_Category) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Category, values_from = count)
```

As we can see the:

-   Furniture includes Bookcases, Chairs, Furnishings, and Tables.

-   Office Supplies includes Appliances, Art, Binders, Envelopes, Fasteners, Labels, Paper, Storage, and Supplies.

-   Technology includes Accessories, Copiers, Machines, and Phones.

We can do the same with which States are in each Region.

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Region, State) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Region, values_from = count)
```

Segments of customers across Ship Modes.

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Ship_Mode, Segment) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Ship_Mode, values_from = count)
```

Regions across Ship Modes.

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Ship_Mode, Region) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Ship_Mode, values_from = count)
```

We can look at the different Categories across different Ship Modes.

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Ship_Mode, Category) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Ship_Mode, values_from = count)
```

Next look at the Segment of customers across different Regions.

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Region, Segment) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Region, values_from = count) 
```

Then the Categories of products across different Regions

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Region, Category) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Region, values_from = count) 
```

Finally, the Segment of customers across Categories of products.

```{r}
# Two-Way Contingency Table
superstore |>
  group_by(Category, Segment) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = Category, values_from = count) 
```

#### Numerical Summaries

Sales: Double

-   The sales money for that given purchase.

```{r}
# Summary Statistics for Sales
sales_summary <- round(summary(superstore$Sales), 3)

c(sales_summary, "Std." = round(sd(superstore$Sales), 3))
```

Quantity: Double

-   The number of that item bought in the purchase.

```{r}
# Summary Statistics for Quantity
quantity_summary <- round(summary(superstore$Quantity), 3)

c(quantity_summary, "Std." = round(sd(superstore$Quantity), 3))
```

Discount: Double

-   The discount for that purchase. Looks like it refers to a percent, like 40% off.

```{r}
# Summary Statistics for Discount
discount_summary <- round(summary(superstore$Discount), 3)

c(discount_summary, "Std." = round(sd(superstore$Discount), 3))
```

Profit: Double

-   The profit made on that purchase.

```{r}
# Summary Statistics for Profit
profit_summary <- round(summary(superstore$Profit), 3)

c(profit_summary, "Std." = round(sd(superstore$Profit), 3))
```

We can look at the summary statistics of Sales per Region.

```{r}
# Numerical Summary Statistics 
superstore |>
  group_by(Region) |>
  summarize(mean_Sales = mean(Sales), 
            med_Sales = median(Sales),
            sd_Sales = sd(Sales),
            IQR_Sales = IQR(Sales))
```

Summary statistics of Profit per Category of product.

```{r}
# Numerical Summary Statistics 
superstore |>
  group_by(Category) |>
  summarize(mean_Profit = mean(Profit), 
            med_Profit = median(Profit),
            sd_Profit = sd(Profit),
            IQR_Profit = IQR(Profit))
```

Summary statistics of Quantity per Ship Mode.

```{r}
# Numerical Summary Statistics 
superstore |>
  group_by(Ship_Mode) |>
  summarize(mean_Quantity = mean(Quantity), 
            med_Quantity = median(Quantity),
            sd_Quantity = sd(Quantity),
            IQR_Quantity = IQR(Quantity))
```

Finally, I'll look at summary statistics of Discount per Segment of customers.

```{r}
# Numerical Summary Statistics 
superstore |>
  group_by(Segment) |>
  summarize(mean_Discount = mean(Discount), 
            med_Discount = median(Discount),
            sd_Discount = sd(Discount),
            IQR_Discount = IQR(Discount))
```

#### Plots

```{r}
# Basic Bar Plot for categorical data
ggplot(superstore, aes(Ship_Mode)) +
  geom_bar() +
  labs(title = "Bar Plot of Shipping Modes")
```

```{r}
# Density plot for numerical data across categories
ggplot(superstore, aes(Discount)) + 
  geom_density(alpha = 0.5, aes(fill = Category)) +
  labs(title = "Density Plot of Discounts per Product Category")
```

```{r}
ggplot(superstore, aes(Quantity)) + 
  geom_density(alpha = 0.5, aes(fill = Region)) +
  labs(title = "Density Plot of Product Quantity Sold per Region")
```

```{r}
# Filter to only show profit within one standard deviation
ggplot(superstore |> filter(abs(Profit) <= mean(Profit) + (sd(Profit))), 
       aes(Profit)) + 
  geom_density(alpha = 0.5, aes(fill = Region)) +
  labs(title = "Density Plot of Profit per Region")
```

```{r}
# Scatter plot of two numerical variables for categorical variable
ggplot(superstore, aes(Sales, Profit, color = Category)) +
  geom_point() +
  labs(title = "Sales vs Profit for Product Categories")
```

```{r}
# Box Plot of Numerical variable per categorical faceted by categorical
# Filter to only show profit within one standard deviation
ggplot(superstore |> filter(abs(Profit) <= mean(Profit) + (sd(Profit))), 
       aes(Segment, Profit, color = Segment)) +
  geom_boxplot() +
  facet_wrap(~ Region) +
  labs(title = "Boxplot of Profit per Customer Segment per Region")
```

```{r}
# Find the proportion of each group
store_heat <- superstore |>
  group_by(Sub_Category, Segment) |>
  summarize(Count = n(), .groups = "drop") |>
  mutate(Proportion = Count / sum(Count))

# Create a heatmap using the proportion of each categorical group
ggplot(store_heat, aes(Segment, Sub_Category, fill = Proportion)) +
         geom_tile() +
  labs(title = "Proportion of Product Sub Categories per Customer Segment")
```
